<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏î‡∏π‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á ‚Äî TileAI</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --cream:#f5f0e8;--stone:#2c2825;--terracotta:#c4623a;
  --gold:#d4a853;--sand:#e8d5b0;--warm-gray:#8c7f74;
}
body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--stone);}

nav{
  display:flex;justify-content:space-between;align-items:center;
  padding:20px 50px;background:var(--stone);
}
.logo{font-family:'Playfair Display',serif;font-size:22px;color:var(--cream);}
.nav-links{display:flex;gap:30px;}
.nav-links a{color:var(--sand);font-size:13px;text-decoration:none;transition:.2s;}
.nav-links a:hover{color:var(--gold);}

.progress-bar{display:flex;background:var(--stone);}
.prog-step{
  flex:1;padding:14px 0;text-align:center;
  font-size:11px;letter-spacing:1px;color:var(--warm-gray);text-transform:uppercase;position:relative;
}
.prog-step.done{color:var(--sand);}
.prog-step.done::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:rgba(255,255,255,.2);}
.prog-step.active{color:var(--gold);}
.prog-step.active::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--gold);}

.hero-strip{
  background:linear-gradient(135deg,#3a2f28,#2c2825);
  padding:50px 50px 40px;
}
.step-tag{
  display:inline-block;background:rgba(196,98,58,.3);
  color:var(--gold);font-size:11px;letter-spacing:2px;
  padding:5px 14px;border-radius:20px;margin-bottom:16px;text-transform:uppercase;
}
.hero-strip h1{font-family:'Playfair Display',serif;font-size:36px;color:var(--cream);line-height:1.2;}
.hero-strip p{color:var(--warm-gray);margin-top:10px;font-size:14px;}

/* LAYOUT */
.layout{display:grid;grid-template-columns:280px 1fr;min-height:calc(100vh - 200px);}

/* LEFT PANEL */
.left-panel{
  background:white;border-right:1px solid #e5e0d8;
  padding:30px 20px;overflow-y:auto;
}
.panel-title{
  font-size:12px;letter-spacing:1px;text-transform:uppercase;
  color:var(--warm-gray);margin-bottom:16px;
}

/* ROOM THUMBNAILS */
.room-list{display:flex;flex-direction:column;gap:10px;margin-bottom:30px;}
.room-thumb{
  border:2px solid transparent;border-radius:10px;overflow:hidden;cursor:pointer;
  transition:.2s;position:relative;
}
.room-thumb:hover{border-color:var(--terracotta);}
.room-thumb.active{border-color:var(--terracotta);}
.room-thumb img{width:100%;height:100px;object-fit:cover;display:block;}
.room-thumb-label{
  position:absolute;bottom:0;left:0;right:0;
  background:rgba(44,40,37,.7);color:white;
  font-size:11px;padding:6px 10px;
}

/* CONTROLS */
.ctrl-section{margin-bottom:24px;}
.ctrl-label{font-size:12px;color:var(--warm-gray);margin-bottom:8px;display:block;letter-spacing:.5px;text-transform:uppercase;}
input[type=range]{width:100%;accent-color:var(--terracotta);cursor:pointer;}
.range-val{font-size:12px;color:var(--stone);margin-top:4px;}

.color-ctrl{display:flex;gap:10px;align-items:center;}
input[type=color]{
  width:40px;height:36px;border:1.5px solid #ddd;
  border-radius:6px;cursor:pointer;padding:2px;
}

/* MAIN CANVAS AREA */
.canvas-area{
  padding:40px;display:flex;flex-direction:column;align-items:center;gap:20px;
}
.canvas-wrap{
  position:relative;border-radius:16px;overflow:hidden;
  box-shadow:0 20px 60px rgba(0,0,0,.2);
  max-width:800px;width:100%;
}
canvas{display:block;width:100%;height:auto;}

/* TILE OVERLAY INFO */
.overlay-info{
  position:absolute;top:16px;right:16px;
  background:rgba(44,40,37,.8);color:white;
  padding:10px 16px;border-radius:8px;font-size:12px;
  backdrop-filter:blur(8px);
}

/* ACTION ROW */
.action-row{
  display:flex;gap:12px;width:100%;max-width:800px;
}
.btn-back{
  padding:14px 24px;background:white;color:var(--stone);
  border:1.5px solid #ddd;border-radius:10px;cursor:pointer;
  font-family:'DM Sans',sans-serif;font-size:14px;transition:.2s;
}
.btn-back:hover{border-color:var(--stone);}
.btn-chat{
  flex:1;padding:14px;
  background:var(--terracotta);color:white;
  border:none;border-radius:10px;cursor:pointer;
  font-family:'DM Sans',sans-serif;font-size:15px;font-weight:500;transition:.2s;
}
.btn-chat:hover{background:#b5572f;}
.btn-save{
  padding:14px 20px;background:white;color:var(--stone);
  border:1.5px solid #ddd;border-radius:10px;cursor:pointer;
  font-family:'DM Sans',sans-serif;font-size:14px;transition:.2s;
}
.btn-save:hover{background:var(--gold);border-color:var(--gold);color:var(--stone);}

.no-tile-msg{
  text-align:center;padding:60px;color:var(--warm-gray);
}
.no-tile-msg a{color:var(--terracotta);text-decoration:none;}

@media(max-width:900px){
  .layout{grid-template-columns:1fr;}
  .left-panel{display:flex;flex-wrap:wrap;gap:16px;padding:20px;}
  nav{padding:16px 20px;}
  .canvas-area{padding:20px;}
}
</style>
</head>
<body>

<nav>
  <div class="logo">‚ú¶ TileAI</div>
  <div class="nav-links">
    <a href="tile-form.html">‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö</a>
    <a href="room-view.html">‡∏î‡∏π‡∏´‡πâ‡∏≠‡∏á</a>
    <a href="chat.html">‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ AI</a>
  </div>
</nav>

<div class="progress-bar">
  <div class="prog-step done">1 ¬∑ ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö</div>
  <div class="prog-step active">2 ¬∑ ‡∏î‡∏π‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á</div>
  <div class="prog-step">3 ¬∑ ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ AI</div>
</div>

<div class="hero-strip">
  <div class="step-tag">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 / 3</div>
  <h1>‡∏î‡∏π‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á</h1>
  <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏™‡∏ß‡∏¢‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô</p>
</div>

<div class="layout">
  <!-- LEFT -->
  <div class="left-panel">

    <div class="panel-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</div>
    <div class="room-list" id="roomList">
      <!-- generated by JS -->
    </div>

    <div class="ctrl-section">
      <span class="ctrl-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∂‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á</span>
      <input type="range" id="opacityCtrl" min="30" max="100" value="80" oninput="render()">
      <div class="range-val" id="opacityVal">80%</div>
    </div>

    <div class="ctrl-section">
      <span class="ctrl-label">‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</span>
      <input type="range" id="scaleCtrl" min="50" max="200" value="100" oninput="render()">
      <div class="range-val" id="scaleVal">100%</div>
    </div>

    <div class="ctrl-section">
      <span class="ctrl-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á</span>
      <input type="range" id="brightCtrl" min="60" max="140" value="100" oninput="render()">
      <div class="range-val" id="brightVal">100%</div>
    </div>

    <div class="ctrl-section">
      <span class="ctrl-label">‡∏™‡∏µ‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠</span>
      <div class="color-ctrl">
        <input type="color" id="groutColor" value="#dddddd" oninput="render()">
        <span style="font-size:13px;color:var(--warm-gray)">‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á</span>
      </div>
    </div>

    <div class="ctrl-section">
      <span class="ctrl-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠</span>
      <input type="range" id="groutW" min="0" max="12" value="4" oninput="render()">
    </div>

  </div>

  <!-- CANVAS AREA -->
  <div class="canvas-area" id="mainArea">

    <div id="noTileMsg" class="no-tile-msg" style="display:none">
      <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ</p>
      <p style="margin-top:8px"><a href="tile-form.html">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á</a></p>
    </div>

    <div class="canvas-wrap" id="canvasWrap">
      <canvas id="roomCanvas"></canvas>
      <div class="overlay-info" id="overlayInfo"></div>
    </div>

    <div class="action-row">
      <button class="btn-back" onclick="window.location.href='tile-form.html'">‚Üê ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á</button>
      <button class="btn-save" onclick="saveImage()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ</button>
      <button class="btn-chat" onclick="window.location.href='chat.html'">‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ AI ‚Üí</button>
    </div>

  </div>
</div>

<script>
/* AUTH */
const user = JSON.parse(localStorage.getItem("user") || "null");
if(!user){ window.location.href="login.html"; }

/* ROOM PRESETS ‚Äî ‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ */
const ROOMS = [
  {
    id:"living1",
    label:"‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏±‡πà‡∏á‡πÄ‡∏•‡πà‡∏ô (‡πÇ‡∏ó‡∏ô‡∏™‡∏ß‡πà‡∏≤‡∏á)",
    url:"https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=800&q=80",
    floorY: 0.52   // ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô (0-1)
  },
  {
    id:"bath1",
    label:"‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥ (‡πÇ‡∏°‡πÄ‡∏î‡∏¥‡∏£‡πå‡∏ô)",
    url:"https://images.unsplash.com/photo-1552321554-5fefe8c9ef14?w=800&q=80",
    floorY: 0.0
  },
  {
    id:"kitchen1",
    label:"‡∏Ñ‡∏£‡∏±‡∏ß (‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ô‡∏≠‡∏£‡πå‡∏î‡∏¥‡∏Å)",
    url:"https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=800&q=80",
    floorY: 0.55
  },
  {
    id:"bedroom1",
    label:"‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô (‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏≠‡∏•)",
    url:"https://images.unsplash.com/photo-1617325247661-675ab4b64ae2?w=800&q=80",
    floorY: 0.60
  },
  {
    id:"outdoor1",
    label:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á (‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á)",
    url:"https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=800&q=80",
    floorY: 0.45
  }
];

let activeRoom = ROOMS[0];
let roomImg = null;
let tileImg = null;

/* BUILD ROOM LIST */
const roomList = document.getElementById("roomList");
ROOMS.forEach((room, i)=>{
  const div = document.createElement("div");
  div.className = "room-thumb" + (i===0?" active":"");
  div.innerHTML = `<img src="${room.url}" alt="${room.label}" loading="lazy"><div class="room-thumb-label">${room.label}</div>`;
  div.onclick = ()=>{
    document.querySelectorAll(".room-thumb").forEach(e=>e.classList.remove("active"));
    div.classList.add("active");
    activeRoom = room;
    loadRoom(room.url);
  };
  roomList.appendChild(div);
});

/* CANVAS */
const canvas = document.getElementById("roomCanvas");
const ctx = canvas.getContext("2d");

function loadRoom(url){
  roomImg = null;
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.onload = ()=>{ roomImg=img; canvas.width=img.width; canvas.height=img.height; render(); };
  img.src = url;
}

function loadTile(url){
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.onload = ()=>{ tileImg=img; render(); };
  img.src = url;
}

function render(){
  if(!roomImg) return;
  const opacity = parseInt(document.getElementById("opacityCtrl").value)/100;
  const scale = parseInt(document.getElementById("scaleCtrl").value)/100;
  const bright = parseInt(document.getElementById("brightCtrl").value)/100;
  const gColor = document.getElementById("groutColor").value;
  const gW = parseInt(document.getElementById("groutW").value);

  document.getElementById("opacityVal").textContent = Math.round(opacity*100)+"%";
  document.getElementById("scaleVal").textContent = Math.round(scale*100)+"%";
  document.getElementById("brightVal").textContent = Math.round(bright*100)+"%";

  /* draw room */
  ctx.filter = `brightness(${bright})`;
  ctx.drawImage(roomImg, 0, 0);
  ctx.filter = "none";

  /* overlay tile on floor area */
  if(tileImg){
    const floorY = Math.floor(activeRoom.floorY * canvas.height);
    const floorH = canvas.height - floorY;
    const tpx = Math.round(120 * scale);

    ctx.save();
    ctx.globalAlpha = opacity;

    /* simple perspective-like clip to bottom portion */
    ctx.beginPath();
    ctx.rect(0, floorY, canvas.width, floorH);
    ctx.clip();

    /* draw tile pattern */
    for(let y=floorY; y<canvas.height; y+=tpx+gW){
      for(let x=0; x<canvas.width; x+=tpx+gW){
        ctx.drawImage(tileImg, x, y, tpx, tpx);
        ctx.fillStyle = gColor;
        ctx.fillRect(x+tpx, y, gW, tpx);
        ctx.fillRect(x, y+tpx, tpx+gW, gW);
      }
    }
    ctx.restore();
  }

  /* update overlay info */
  const cfg = JSON.parse(localStorage.getItem("tileConfig") || "{}");
  document.getElementById("overlayInfo").textContent =
    [cfg.material, cfg.color, cfg.size ? cfg.size+"‡∏ã‡∏°." : ""].filter(Boolean).join(" ¬∑ ") || "‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á AI";
}

/* SAVE */
function saveImage(){
  const link = document.createElement("a");
  link.download = "tileai-room.png";
  link.href = canvas.toDataURL();
  link.click();
}

/* INIT */
const tileUrl = localStorage.getItem("tileUrl");
if(!tileUrl){
  document.getElementById("noTileMsg").style.display = "block";
  document.getElementById("canvasWrap").style.display = "none";
} else {
  loadTile(tileUrl);
  loadRoom(ROOMS[0].url);
}
</script>
</body>
</html>
